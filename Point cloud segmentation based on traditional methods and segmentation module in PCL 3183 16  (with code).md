The following chapters 1, how to learn PCL and some basic knowledge 2, introduction to the IO port and common module in PCL 3, introduction to two data structures commonly used in PCL, KDtree and Octree, preface, three-dimensional point cloud segmentation is to divide point cloud objects with the same attributes, so as to process the point cloud objects separately, but because point cloud data is a highly redundant and uneven data structure, point cloud segmentation is challenging. 

 Since its launch in 2011, the Point Cloud Library (PCL) has been widely used in the industry. The library contains the most advanced 3D perception algorithms and includes the interface of LIDAR and 3D scanners, which makes the Point Cloud Library PCL continue to grow in the field of robotics. It has been updated to 1.9.1 version so far. In image segmentation, foreground and background segmentation processing is often used. In point cloud processing, for a given point cloud data, the goal of segmentation is to cluster points with similar characteristics into uniform areas. According to the segmentation results, it is applied to various aspects of scene analysis. The general method is to construct graphics according to the grid of the input point cloud, and use the normal of the boundary line, smoothness or concavo-convex information for clustering segmentation. In the article [1], the segmentation methods are investigated: concavo-convex segmentation, watershed analysis, hierarchical clustering, regional growth and spectral clustering. These methods are not only applied to images, but also widely used in the segmentation of point cloud data. 

 In computer vision, the segmentation of 2D images is a very classic problem, and has a history of more than ten years of research. Among them, traditional methods are more popular: Graph Cuts [2], including Normalized Cuts and Min Cuts. These methods are also suitable for 3D point cloud segmentation, and this part of the content has been open-sourced in PCL. 

 The point cloud segmentation algorithm should have the following three important properties: (1) For example, trees have different characteristics from cars. When the number of features in the point cloud data increases, the segmentation algorithm should be robust and able to learn how to automatically distinguish them. (2) Secondly, the segmentation should be able to infer the properties of these points in the sparse point cloud or determine which label belongs to them based on their adjacent information. (3) The segmentation algorithm should be able to apply to different scanners, even if the same scene generates point clouds in different scanners with different properties, and the quality and sparsity of the generated point clouds are also different. 

 The challenge of point cloud segmentation: Although point cloud data can determine the shape, size and some other properties of 3D objects, 3D point cloud data is usually noisy, sparse and disordered due to the limitations of sensors, such as the linear and angular rate changes of lidar, and the acquisition density of points is also uneven. In addition, the surface shape of point cloud data can be arbitrary, and there is no statistical distribution of data. So this brings a series of problems to the segmentation of point clouds. 

 ![avatar]( 20190522223410731.PNG) 

 数据集介绍：  Example scenes of (a) Cornell RGBD dataset, (b) VMR-Oakland dataset, © KITTI dataset, and (d) Robotic 3D Scan Repository 

 As shown in Figure 1, these data can be divided into two categories: indoor datasets captured by Kinect, and outdoor datasets captured by laser scanners (such as lidar). Applying segmentation algorithms to these public datasets allows researchers to better understand the advantages and disadvantages of segmentation algorithms 

 (1) Cornell RGBD dataset: This dataset has an indoor field of 52 labeled point clouds with RGB values (24 labeled office scenes and 28 labeled home scenes). Point cloud data is created from raw RGB-D images using RGBDSLAM [45]. The dataset consists of approximately 550 views with 2495 labels corresponding to 27 kinds of objects. (2) VMR-Oakland dataset: This dataset is a labeled point cloud data collected from the CMU campus via a mobile platform. The point clouds are collected using a laser scanner and saved in text format, with three real-valued coordinates written in each row. And training datasets, and test sets are provided. ** (3) KITTI dataset: ** This dataset includes a large amount of unorganized point cloud data captured by a 360 ° Velodyne laser scanner. It is the one with manually labeled true value boxes, such as the true value bounding box for outdoors such as cars, pedestrians, trams, trucks, and bicycles, for training dataset. (4) Robotic 3D Scan Repository: This dataset provides a collection of 3D point cloud datasets for indoor and outdoor environments. Some datasets include heat and color information. This is a huge collection of 3D point cloud data that can be used not only for segmentation but also for different other algorithms. However, these datasets have not been labeled and it may be that a pre-processing step is required before they can be used as input to segmentation algorithms. 

 ![avatar]( 20190522223538245.PNG) 

 Segmentation algorithm: Next, five traditional segmentation algorithms will be introduced: edge-based method, area-based method, attribute-based method, model-based method and graph-based optimization method (1) Edge-based method, edge is the basic feature of describing the shape of the point cloud object, this method detects the boundary of some areas of the point cloud to obtain the segmentation area, the principle of these methods is to locate the intensity change of the edge point, the paper [2] proposes an edge detection technology, by computing layer, detecting the change in the direction of the unit normal vector on the surface to fit the line segment. The paper [3] is based on the grouping of scan lines for fast segmentation. Although the segmentation speed of the edge-based method is relatively fast, the accuracy cannot be guaranteed, because the edge is very sensitive to noise and uneven or sparse point clouds. (2) Region-based segmentation methods, region-based methods use neighborhood information to classify nearby points with similar properties to obtain segmented regions and distinguish differences between different regions. Region-based methods are more accurate than edge-based methods. But they have problems with over-segmentation or under-segmentation and how to accurately determine the boundary of the region. Researchers divide region-based methods into two categories: seeded region (or bottom-up) methods and non-seeded region (or top-down) methods. 

 Seed area method: Seed-based area segmentation starts by selecting multiple seed points. From these seed points as the starting point, the point cloud area is gradually formed by adding the neighborhood points of the seed. The original algorithm was proposed in the paper [4]. The algorithm mainly consists of two steps: (1) identify the seed points based on the curvature of each point, and (2) grow the seed points according to a predetermined standard, which can be the similarity of the points and the similarity of the surface of the point cloud. This method is also very sensitive to noise points and is time-consuming. But there have been many subsequent improvements based on this method. For example, for the method of regional growth of lidar data, it is proposed to grow seed points based on the normal vector of seed points and the distance from the growth plane. The seed area method is highly dependent on the selected seed points. Inaccurate selection of seed points can affect the segmentation process and may lead to under-segmentation or over-segmentation. Selecting seed points as well as controlling the growth process is time-consuming. The segmentation result may be sensitive to the selected compatibility threshold. Another difficulty is deciding whether to add points in a given area because this method is also sensitive to noise from point clouds. 

 Non-seeded region method: This method is based on a top-down approach. First, all points are divided into a region. Then the subdivision process begins to divide it into smaller regions. Paper [5] uses this method to guide the process of clustering planar regions to reconstruct the complete geometry of the building. This work introduces a segmentation method based on the confidence rate of local regions as planes. The limitation of this method is that it will also be possible to over-segment, and it does not perform well when dividing other objects (e.g. trees). The main difficulty of non-seeded region methods is deciding where and how to segment. Another limitation of these methods is that they require a lot of prior knowledge (e.g., object model, number of regions, etc.), and then this unknown prior knowledge is usually unknown in complex scenarios. 

 (3) Attribute-based method, which is a robust segmentation method based on the properties of point cloud data, this method generally includes two separate steps (1) The first step, attribute-based calculation, in the second step, will be clustered according to the properties of the calculated points. This clustering method can generally adapt to the spatial relationship and various properties of the point cloud. Finally, point clouds with different properties are segmented, but the limitation of this method is that they are highly dependent on the quality of derived properties, so the first step is required to accurately calculate the properties of the point cloud data, so that the best effect can be segmented according to the category of properties in the second step. The paper [6] is realized by this method, and proposes a clustering analysis method based on the feature space. In this method, a normal vector is derived using an adaptive slope neighborhood system. The properties of the point cloud data, such as distance, point density, and the distribution of points in the horizontal or vertical directions, are used to define the domain between the measurement points. Then the difference between the slope of the normal vector in each direction and the data of the point neighborhood is used as the property of the clustering. This method can eliminate the influence of outliers and noise. The property-based method is an efficient way to segment the point cloud into the same attribute area, and the segmentation results are flexible and accurate. However, these methods rely on the definition of the neighborhood between points and the point density of the point cloud data. Another limitation of this approach is that it is time-consuming when dealing with multidimensional properties of a large number of input points. 

 (4) Model-based method, which groups point clouds based on geometric shapes such as spheres, cones, planes, and cylinders. According to these shapes, points with the same mathematical representation will be divided into the same set of points. A well-known algorithm, RANSAC (RANdom SAmple Consensus), is introduced in the paper [7]. RANSAC is a powerful model for detecting mathematical features such as lines and circles. This application is extremely extensive and can be considered the most advanced technology for model fitting. The methods that need to be improved in the segmentation of 3D point clouds are inherited from this method. The model-based method has pure mathematical principles, is fast and powerful, and has unique value. The main limitation of this method is the inaccuracy of dealing with different point clouds. This method has been implemented in point cloud libraries based on various models such as line, plane, circle, etc. 

 (5) Graph-based optimization methods. Graph-based optimization methods are very popular in the application of robots. The well-known method is the FH algorithm [7]. This method is simple and efficient, and like the Kruskal algorithm, it is used to find the minimum spanning tree in the graph. Much of the work of graph-based methods is put into probabilistic inference models, such as conditional random fields (CRFs), methods that use CRFs to label points with different geometric surface primitives. Graph-based optimization methods successfully segment point clouds in complex urban environments, with near real-time performance. For comparison with other methods, graph-based methods can perform complex scenes in point cloud data. However, these methods are usually not able to run in real time. Some of them may require steps such as offline training. 

 In summary, the segmentation methods are divided into five categories above. However, in general, there are two basic methods. The first method uses pure mathematical models and geometric inference techniques, such as region growth or model fitting, to fit linear and nonlinear models to point cloud data. This method allows fast run times to achieve good results. The limitations of this method are that it is difficult to choose the size of the model when fitting objects, is sensitive to noise and does not work well in complex scenes. 

 The second method uses the method of feature descriptors to extract 3D features from point cloud data, and uses machine learning techniques to learn different classes of object types, and then uses the resulting model to classify the acquired data. In complex scenarios, machine learning techniques will outperform techniques based purely on geometric reasoning. The reason is that it is difficult to find and fit complex geometric figures to objects due to noise, uneven density, and occlusion in point cloud data. Although machine learning techniques can provide better results, they are usually slow and depend on the results of the feature extraction process. These algorithms have been implemented in PCL and all have ready-made demos to view the effect. 

 The following will introduce the segmentation module in PCL point cloud in detail. This module is based on the above basic modules, such as how to construct point cloud data into kdtree or Octree structure and use FLANN (nearest neighbor search) to find the relationship between points and surrounding views. Classes commonly used in PCL are as follows: class pcl :: ConditionalEuclideanClustering < PointT > This class implements the classification algorithm of European clustering for setting conditions 

  ```python  
After clicking on the GitHub Sponsor button above, you will obtain access permissions to my private code repository ( https://github.com/slowlon/my_code_bar ) to view this blog code. By searching the code number of this blog, you can find the code you need, code number is: 2024020309573742942
  ```  
 //The above is a field based on point cloud intensity information for setting, that is, the intensity information requirement of two points/ 

  ```python  
After clicking on the GitHub Sponsor button above, you will obtain access permissions to my private code repository ( https://github.com/slowlon/my_code_bar ) to view this blog code. By searching the code number of this blog, you can find the code you need, code number is: 2024020309573742942
  ```  
 //Add our conditional function here 

  ```python  
After clicking on the GitHub Sponsor button above, you will obtain access permissions to my private code repository ( https://github.com/slowlon/my_code_bar ) to view this blog code. By searching the code number of this blog, you can find the code you need, code number is: 2024020309573742942
  ```  
 Class pcl :: CPC Segmentation < PointT > A segmentation algorithm for segmenting hyperprime graphs. It uses local concavity-induced plane cutting for recursive segmentation. Use locally constrained directed RANSAC for segmentation. 

 CPC segmentation and LCCP segmentation are inherited relationships: specific papers can be viewed in the literature 

>  M. Schoeler, J. Papon, F. Woergoetter Constrained Planar Cuts - Object Partitioning for Point Clouds In Proceedings of the IEEE Conference on Computer Vision and Pattern Recognition (CVPR) 2015 

 Class pcl :: EuclideanClusterExtraction < PointT > Euclidean clustering extraction is a point cloud class for clustering and segmentation in the Euclidean sense. This function is often used. It has been mentioned many times in the previous examples, so I will not give an example here. You can check the relevant blog content 

 Class pcl :: LabeledEuclideanClusterExtraction < PointT > labeledeuclidenclusterextraction represents a segmented class for clustering extraction with label information in the Euclidean sense, 

 Class pcl :: ExtractPolygonalPrismData < PointT > ExtractPolygonalPrismData Use a set of point indices that represent a plane model and together with the given height generate a 3D polygonal prism. Then use the polygonal prism to split all the points that lie within it. One example of its use is to extract data that lies within a set of 3D boundaries (e.g. objects supported by planes). 

  ```python  
After clicking on the GitHub Sponsor button above, you will obtain access permissions to my private code repository ( https://github.com/slowlon/my_code_bar ) to view this blog code. By searching the code number of this blog, you can find the code you need, code number is: 2024020309573742942
  ```  
 Class pcl :: GrabCut < PointT > implements GrabCut splitting. 

 class pcl::segmentation::detail::RandomWalker< Graph, EdgeWeightMap, VertexColorMap > 

 Multi-Label Graph Segmentation for Random Walking 

>  Random Walks for Image Segmentation 

 Class pcl :: LC CP Segmentation < PointT > A simple segmentation algorithm that divides a hyperprime graph into locally convex connected hyperprime groups separated by concave boundaries. Related papers 

>  S. C. Stein, M. Schoeler, J. Papon, F. Woergoetter Object Partitioning using Local Convexity In Proceedings of the IEEE Conference on Computer Vision and Pattern Recognition (CVPR) 2014 

 Class pcl :: SACSegmentationFromNormals < PointT, PointNT > Binding Point Cloud Data Surface Normal Vector Segmentation Using RANSAC Method 

 Class pcl :: SeededHueSegmentation class pcl :: SegmentDifferences < PointT > SegmentDifferences takes the difference between two spatially aligned point clouds and returns the difference between them at the maximum given distance threshold. 

 Class pcl :: SupervoxelClustering < PointT > implements a super voxel algorithm based on voxel structure, normals and RGB values. The specific paper is as follows Voxel Cloud Connectivity Segmentation - Supervoxels from PointClouds In Proceedings of the IEEE Conference on Computer Vision and Pattern Recognition (CVPR) 2013 

 The next chapter will specifically introduce the model-based segmentation method implemented in PCL 

>  【1】A. Shamir, Segmentation and shape extraction of 3D boundary meshes (state of the art report), in Eurographics, 2006 【2】 B. Bhanu, S. Lee,C. Ho, and T. Henderson, Range data processing:Representation of surfaces by edges. In proc.int. Pattern recognition conf, 1896 【3】X.Y. Jiang, H. Bunke, and U. Meier, Fast range image segmentation using high level segmentation primitives, In 3rd IEEE Workshop on Applications of Compute Vision, USA, 1996 【4】P.J. Besl, R.C. Jain, Segmentation through variable order surface fitting, IEEE Transaction on Pattern Analysis and Machine Intelligence 10, 1988. 【5】J. Chen, B.Chen, Architectural modeling from sparsely scanned range data. Int. J. Comput. Vision 78, 2008. 【6】S. Filin, N. Pfeifer, Segmentation of airborne data using a slope adaptive filter, ISPRS J. Photogramm. Remote Sens., vol. 60, pp. 71- 80, 2006. 【7】M. Fischler, R. Bolles, Random sample consensus: a paradigm for model fitting with applications to image analysis and automated cartography Communications of the ACM 【8】P.F. Felzenszwalb, D.P. Huttenlocher, Efficient Graph-Based Image Segmentation, International Journal of Computer Vision, 59(2), 2004. 

 ![avatar]( 20190522224320789.PNG) 

